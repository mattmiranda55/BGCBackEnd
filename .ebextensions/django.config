option_settings:
  aws:elasticbeanstalk:application:environment:
    DJANGO_SETTINGS_MODULE: "BGC_Back_End.settings"
    PYTHONPATH: "/var/app/current:$PYTHONPATH"
  aws:elasticbeanstalk:container:python:
    WSGIPath: "BGC_Back_End.wsgi:application"
  aws:elasticbeanstalk:environment:proxy:staticfiles:
    /static/: static/
  aws:elasticbeanstalk:environment:
    PYTHON_VERSION: "3.11"  # Ensure this matches the Python version your project uses

container_commands:
  01_create_venv:
    command: "python3 -m venv /var/app/staging/.venv"
    leader_only: true
  02_install_requirements:
    command: "/var/app/staging/.venv/bin/pip install -r /var/app/staging/requirements.txt"
    leader_only: true

files:
  "/etc/nginx/conf.d/proxy.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      client_max_body_size 50M;

commands:
  01_migrate:
    command: "source /var/app/staging/.venv/bin/activate && python3 manage.py migrate"
    leader_only: true
  02_collectstatic:
    command: "source /var/app/staging/.venv/bin/activate && python3 manage.py collectstatic --noinput"
    leader_only: true
